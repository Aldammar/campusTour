<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>AR.js Avatar Example</title>
    <!-- A-Frame -->
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <!-- AR.js -->
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
</head>
<body style="margin: 0; overflow: hidden;">
<a-scene
        embedded
        arjs>
    <!-- Marker using the local pattern-hiro.patt file -->
    <a-marker type="pattern" url="assets/pattern-Logo_schwarz.patt" size="0.25">
        <!-- 3D Avatar model of an Avocado -->
        <a-entity
                gltf-model="models/Avocado.gltf"
                position="0 0 0"
                scale="10 10 10"
                rotation="0 180 0">
            >
        </a-entity>
        <!-- Text message -->
        <a-text id="message" value="Tap me to speak!" position="0 1.5 0" scale="3 3 3" color="red"
                rotation="0 180 0"></a-text>
    </a-marker>
    <a-entity camera></a-entity>
</a-scene>

<script>
    window.onload = () => {
        const messageText = "Hello! Welcome to my AR world!";
        const url_arr = document.location.href.split("/");
        if (url_arr[url_arr.length - 1] !== "campusTour") {
            url_arr.pop();
        }
        const url = url_arr.join("/") + "/";


        document.querySelectorAll('a-marker').forEach(marker => {
            const originalUrl = marker.getAttribute('url');
            marker.setAttribute('url', `${url}${originalUrl}`);
        });
        document.querySelectorAll('a-entity').forEach(marker => {
            if (marker.hasAttribute('gltf-model')) {
                const originalUrl = marker.getAttribute('gltf-model');
                marker.setAttribute('gltf-model', `${url}${originalUrl}`);
            }
        });


        // Trigger speech when the model or marker is clicked
        document.querySelector('a-marker').addEventListener('click', () => {
            const speech = new SpeechSynthesisUtterance(messageText);
            const voice = window.speechSynthesis.getVoices().find(value => value.lang === "en-US")|| window.speechSynthesis.getVoices()[0];
            speech.voice = voice;
            window.speechSynthesis.speak(speech);

            // Update the text in the AR scene
            document.querySelector('#message').setAttribute('value', messageText);
        });
    };
</script>
</body>
</html>
